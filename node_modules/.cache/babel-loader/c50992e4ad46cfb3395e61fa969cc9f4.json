{"ast":null,"code":"var _jsxFileName = \"/Users/prashantkansal/Desktop/techgropse/digiTender/digiTenderFrontend/src/customerComponents/customerTenderManagementComponents/customerEditTender.jsx\";\nimport React, { Component } from \"react\";\nimport Joi from \"joi-browser\";\nimport DisplayTenderItemList from \"../../microComponents/displayTenderItemList\";\nimport AddItemCard from \"../../microComponents/addItemCard\";\nimport UploadTenderTermsAndConditions from \"../../microComponents/uploadTenderTermsAndConditions\";\nimport { createTender } from \"../../services/tenderService\";\nimport httpService from \"../../services/httpService\";\nimport { toast } from \"react-toastify\";\nimport config from \"../../config.json\";\nimport EditTenderDetailsCard from \"../../microComponents/editTenderDetailsCard\";\n\nclass CustomerEditTender extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      tender: null,\n      formData: {\n        closingDate: \"\",\n        deliveryDate: \"\",\n        deliveryLocation: \"\",\n        budgetAmount: \"\",\n        isPublished: false,\n        itemList: []\n      },\n      file: null,\n      errors: {}\n    };\n    this.schema = {\n      closingDate: Joi.date().min(\"now\").required(),\n      deliveryDate: Joi.date().greater(Joi.ref(\"closingDate\")).required(),\n      budgetAmount: Joi.number().required(),\n      deliveryLocation: Joi.string().required(),\n      isPublished: Joi.boolean().required(),\n      itemList: Joi.array().items(Joi.object({\n        category: Joi.string().required(),\n        name: Joi.string().required(),\n        quantity: Joi.number().required(),\n        unitOfMeasure: Joi.string().required()\n      })).min(1)\n    };\n\n    this.updateTenderDetails = (tenderDetails, errors) => {\n      let formData = { ...this.state.formData\n      };\n\n      for (let item in tenderDetails) {\n        formData[item] = tenderDetails[item];\n      }\n\n      this.setState({\n        formData: formData\n      });\n      this.setState({\n        errors: errors\n      });\n    };\n\n    this.addItem = item => {\n      const formData = { ...this.state.formData\n      };\n      formData.itemList.push(item);\n      this.setState({\n        formData\n      });\n    };\n\n    this.itemDelete = itemIndex => {\n      const formData = { ...this.state.formData\n      };\n      formData.itemList.splice(itemIndex, 1);\n      this.setState({\n        formData\n      });\n    };\n\n    this.uploadFile = async file => {\n      this.setState({\n        file\n      });\n    };\n\n    this.validateOnSubmit = () => {\n      const result = Joi.validate(this.state.formData, this.schema, {\n        abortEarly: false\n      });\n      console.log(result.error);\n      if (!result.error) return null;\n      const errors = {};\n\n      if (result.error) {\n        for (let item of result.error.details) {\n          errors[item.path[0]] = item.message;\n        }\n\n        return errors;\n      }\n    };\n\n    this.published = async () => {\n      let formData = { ...this.state.formData\n      };\n      formData.isPublished = true;\n      this.setState({\n        formData\n      });\n    };\n\n    this.saveForLater = async () => {\n      let formData = { ...this.state.formData\n      };\n      formData.isPublished = false;\n      this.setState({\n        formData\n      });\n      this.handleSubmit();\n    };\n\n    this.handleSubmit = async e => {\n      if (e !== undefined) {\n        e.preventDefault();\n      }\n\n      const errors = this.validateOnSubmit();\n      this.setState({\n        errors: errors || {}\n      });\n      if (errors) return;\n      await this.doSubmit();\n    };\n\n    this.doSubmit = async () => {\n      const formData = new FormData();\n      formData.append(\"tenderId\", this.state.tender._id);\n\n      for (const item in this.state.formData) {\n        if (item === \"itemList\") {\n          formData.append(item, JSON.stringify(this.state.formData[item]));\n        } else formData.append(item, this.state.formData[item]);\n      }\n\n      formData.append(\"myFile1\", this.state.file, this.state.file.name);\n      const {\n        data,\n        error\n      } = await editSavedTender(formData);\n\n      if (data) {\n        this.props.history.push(\"/customer\");\n      }\n\n      if (error) return;\n    };\n  }\n\n  async componentDidMount() {\n    if (!this.props.match.params.tenderId) return null;\n    let data;\n\n    try {\n      data = await httpService.get(`${config.apiendpoint}/customer/myTenders/${this.props.match.params.tenderId}`);\n      await this.setState({\n        tender: data.data.tender\n      });\n      let formData = { ...this.state.formData\n      };\n\n      for (let item in formData) {\n        formData[item] = this.state.tender[item];\n      }\n\n      formData.itemList.map(itemObject => {\n        delete itemObject._id;\n      });\n      await this.setState({\n        formData\n      });\n    } catch (error) {\n      toast.error(error.message);\n      return;\n    }\n  }\n\n  render() {\n    const {\n      formData\n    } = this.state;\n\n    if (formData.closingDate == \"\") {\n      return null;\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container-fluid\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"breadcrumb-header justify-content-between\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"my-auto\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"d-flex\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"content-title mb-0 my-auto\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 15\n      }\n    }, \"Tender\"), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"text-muted mt-1 tx-13 ml-2 mb-0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 15\n      }\n    }, \"/ Edit Tender\")))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row row-sm\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-xl-12\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(EditTenderDetailsCard, {\n      updateTenderDetails: (formData, errors) => this.updateTenderDetails(formData, errors),\n      formData: this.state.formData,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(AddItemCard, {\n      addItem: item => this.addItem(item),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 13\n      }\n    }), formData.itemList.length === 0 ? /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 15\n      }\n    }, \"\\\"no items added yet\\\"\") : /*#__PURE__*/React.createElement(DisplayTenderItemList, {\n      itemList: formData.itemList,\n      itemDelete: index => this.itemDelete(index),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(UploadTenderTermsAndConditions, {\n      onUpload: file => this.uploadFile(file),\n      published: this.published,\n      saveForLater: this.saveForLater,\n      disableButton: this.validateOnSubmit(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"modal\",\n      id: \"publishmodal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"modal-dialog modal-dialog-centered\",\n      role: \"document\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"modal-content tx-size-sm\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"modal-body tx-center pd-y-20 pd-x-20\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      \"aria-label\": \"Close\",\n      className: \"close\",\n      \"data-dismiss\": \"modal\",\n      type: \"button\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      \"aria-hidden\": \"true\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 19\n      }\n    }, \"\\xD7\")), /*#__PURE__*/React.createElement(\"i\", {\n      className: \"fa fa-upload tx-100 tx-orange lh-1 mg-t-20 d-inline-block\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"h4\", {\n      className: \"tx-orange tx-semibold mg-b-20\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 17\n      }\n    }, \"Are you sure u want to publish?\"), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"mg-b-20 mg-x-20\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 17\n      }\n    }, \"There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration.\"), /*#__PURE__*/React.createElement(\"button\", {\n      \"aria-label\": \"Close\",\n      className: \"btn ripple btn-success pd-x-25\",\n      \"data-dismiss\": \"modal\",\n      type: \"button\",\n      onClick: this.handleSubmit,\n      disabled: this.validateOnSubmit(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 17\n      }\n    }, \"Continue\"))))));\n  }\n\n}\n\nexport default CustomerEditTender;","map":{"version":3,"sources":["/Users/prashantkansal/Desktop/techgropse/digiTender/digiTenderFrontend/src/customerComponents/customerTenderManagementComponents/customerEditTender.jsx"],"names":["React","Component","Joi","DisplayTenderItemList","AddItemCard","UploadTenderTermsAndConditions","createTender","httpService","toast","config","EditTenderDetailsCard","CustomerEditTender","state","tender","formData","closingDate","deliveryDate","deliveryLocation","budgetAmount","isPublished","itemList","file","errors","schema","date","min","required","greater","ref","number","string","boolean","array","items","object","category","name","quantity","unitOfMeasure","updateTenderDetails","tenderDetails","item","setState","addItem","push","itemDelete","itemIndex","splice","uploadFile","validateOnSubmit","result","validate","abortEarly","console","log","error","details","path","message","published","saveForLater","handleSubmit","e","undefined","preventDefault","doSubmit","FormData","append","_id","JSON","stringify","data","editSavedTender","props","history","componentDidMount","match","params","tenderId","get","apiendpoint","map","itemObject","render","length","index"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n\nimport Joi from \"joi-browser\";\nimport DisplayTenderItemList from \"../../microComponents/displayTenderItemList\";\nimport AddItemCard from \"../../microComponents/addItemCard\";\nimport UploadTenderTermsAndConditions from \"../../microComponents/uploadTenderTermsAndConditions\";\n\nimport { createTender } from \"../../services/tenderService\";\n\nimport httpService from \"../../services/httpService\";\nimport { toast } from \"react-toastify\";\nimport config from \"../../config.json\";\nimport EditTenderDetailsCard from \"../../microComponents/editTenderDetailsCard\";\n\nclass CustomerEditTender extends Component {\n  state = {\n    tender: null,\n    formData: {\n      closingDate: \"\",\n      deliveryDate: \"\",\n      deliveryLocation: \"\",\n      budgetAmount: \"\",\n      isPublished: false,\n      itemList: [],\n    },\n    file: null,\n    errors: {},\n  };\n\n  schema = {\n    closingDate: Joi.date().min(\"now\").required(),\n    deliveryDate: Joi.date().greater(Joi.ref(\"closingDate\")).required(),\n    budgetAmount: Joi.number().required(),\n    deliveryLocation: Joi.string().required(),\n    isPublished: Joi.boolean().required(),\n    itemList: Joi.array()\n      .items(\n        Joi.object({\n          category: Joi.string().required(),\n          name: Joi.string().required(),\n          quantity: Joi.number().required(),\n          unitOfMeasure: Joi.string().required(),\n        })\n      )\n      .min(1),\n  };\n\n  async componentDidMount() {\n    if (!this.props.match.params.tenderId) return null;\n    let data;\n    try {\n      data = await httpService.get(\n        `${config.apiendpoint}/customer/myTenders/${this.props.match.params.tenderId}`\n      );\n      await this.setState({ tender: data.data.tender });\n      let formData = { ...this.state.formData };\n      for (let item in formData) {\n        formData[item] = this.state.tender[item];\n      }\n      formData.itemList.map((itemObject) => {\n        delete itemObject._id;\n      });\n      await this.setState({ formData });\n    } catch (error) {\n      toast.error(error.message);\n      return;\n    }\n  }\n\n  updateTenderDetails = (tenderDetails, errors) => {\n    let formData = { ...this.state.formData };\n    for (let item in tenderDetails) {\n      formData[item] = tenderDetails[item];\n    }\n    this.setState({ formData: formData });\n    this.setState({ errors: errors });\n  };\n\n  addItem = (item) => {\n    const formData = { ...this.state.formData };\n    formData.itemList.push(item);\n    this.setState({ formData });\n  };\n\n  itemDelete = (itemIndex) => {\n    const formData = { ...this.state.formData };\n    formData.itemList.splice(itemIndex, 1);\n    this.setState({ formData });\n  };\n\n  uploadFile = async (file) => {\n    this.setState({ file });\n  };\n\n  validateOnSubmit = () => {\n    const result = Joi.validate(this.state.formData, this.schema, {\n      abortEarly: false,\n    });\n    console.log(result.error);\n    if (!result.error) return null;\n    const errors = {};\n    if (result.error) {\n      for (let item of result.error.details) {\n        errors[item.path[0]] = item.message;\n      }\n      return errors;\n    }\n  };\n\n  published = async () => {\n    let formData = { ...this.state.formData };\n    formData.isPublished = true;\n    this.setState({ formData });\n  };\n\n  saveForLater = async () => {\n    let formData = { ...this.state.formData };\n    formData.isPublished = false;\n    this.setState({ formData });\n    this.handleSubmit();\n  };\n\n  handleSubmit = async (e) => {\n    if (e !== undefined) {\n      e.preventDefault();\n    }\n    const errors = this.validateOnSubmit();\n    this.setState({ errors: errors || {} });\n\n    if (errors) return;\n\n    await this.doSubmit();\n  };\n\n  doSubmit = async () => {\n    const formData = new FormData();\n    formData.append(\"tenderId\", this.state.tender._id);\n    for (const item in this.state.formData) {\n      if (item === \"itemList\") {\n        formData.append(item, JSON.stringify(this.state.formData[item]));\n      } else formData.append(item, this.state.formData[item]);\n    }\n\n    formData.append(\"myFile1\", this.state.file, this.state.file.name);\n\n    const { data, error } = await editSavedTender(formData);\n    if (data) {\n      this.props.history.push(\"/customer\");\n    }\n    if (error) return;\n  };\n\n  render() {\n    const { formData } = this.state;\n    if (formData.closingDate == \"\") {\n      return null;\n    }\n    return (\n      <div className=\"container-fluid\">\n        <div className=\"breadcrumb-header justify-content-between\">\n          <div className=\"my-auto\">\n            <div className=\"d-flex\">\n              <h4 className=\"content-title mb-0 my-auto\">Tender</h4>\n              <span className=\"text-muted mt-1 tx-13 ml-2 mb-0\">\n                / Edit Tender\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"row row-sm\">\n          <div className=\"col-xl-12\">\n            <EditTenderDetailsCard\n              updateTenderDetails={(formData, errors) =>\n                this.updateTenderDetails(formData, errors)\n              }\n              formData={this.state.formData}\n            />\n            <AddItemCard addItem={(item) => this.addItem(item)} />\n            {formData.itemList.length === 0 ? (\n              <h2>\"no items added yet\"</h2>\n            ) : (\n              <DisplayTenderItemList\n                itemList={formData.itemList}\n                itemDelete={(index) => this.itemDelete(index)}\n              />\n            )}\n\n            <UploadTenderTermsAndConditions\n              onUpload={(file) => this.uploadFile(file)}\n              published={this.published}\n              saveForLater={this.saveForLater}\n              disableButton={this.validateOnSubmit()}\n            />\n          </div>\n        </div>\n        <div className=\"modal\" id=\"publishmodal\">\n          <div className=\"modal-dialog modal-dialog-centered\" role=\"document\">\n            <div className=\"modal-content tx-size-sm\">\n              <div className=\"modal-body tx-center pd-y-20 pd-x-20\">\n                <button\n                  aria-label=\"Close\"\n                  className=\"close\"\n                  data-dismiss=\"modal\"\n                  type=\"button\"\n                >\n                  <span aria-hidden=\"true\">×</span>\n                </button>\n                <i className=\"fa fa-upload tx-100 tx-orange lh-1 mg-t-20 d-inline-block\"></i>\n                <h4 className=\"tx-orange tx-semibold mg-b-20\">\n                  Are you sure u want to publish?\n                </h4>\n                <p className=\"mg-b-20 mg-x-20\">\n                  There are many variations of passages of Lorem Ipsum\n                  available, but the majority have suffered alteration.\n                </p>\n                <button\n                  aria-label=\"Close\"\n                  className=\"btn ripple btn-success pd-x-25\"\n                  data-dismiss=\"modal\"\n                  type=\"button\"\n                  onClick={this.handleSubmit}\n                  disabled={this.validateOnSubmit()}\n                >\n                  Continue\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default CustomerEditTender;\n"]},"metadata":{},"sourceType":"module"}